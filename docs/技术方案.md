# 今天吃什么大转盘 - 技术方案文档

## 1. 技术架构概述

### 1.1 技术栈选型

- **前端框架**: Vue 3 (Composition API)
- **开发语言**: TypeScript
- **构建工具**: Vite
- **路由管理**: Vue Router 4
- **状态管理**: Pinia
- **UI 组件库**: 自定义组件 + 必要时引入轻量级组件库
- **CSS 预处理器**: SCSS
- **动画库**: CSS3 Animations + 必要时使用 GSAP
- **代码规范**: ESLint + Prettier
- **类型检查**: TypeScript + Vue TSC

### 1.2 架构设计原则

- **组件化开发**: 采用 Vue 3 Composition API，提高代码复用性
- **类型安全**: 全面使用 TypeScript，确保类型安全
- **响应式设计**: 移动优先，适配多种设备尺寸
- **性能优化**: 懒加载、代码分割、资源优化
- **可维护性**: 清晰的目录结构和代码组织

## 2. 项目目录结构

```
order-takeout-turntable/
├── public/                          # 静态资源目录
│   ├── favicon.ico
│   └── index.html
├── src/                             # 源代码目录
│   ├── assets/                      # 静态资源
│   │   ├── images/                  # 图片资源
│   │   ├── icons/                   # 图标资源
│   │   └── styles/                  # 全局样式
│   │       ├── index.scss           # 样式入口文件
│   │       ├── variables.scss       # SCSS 变量
│   │       ├── mixins.scss          # SCSS 混入
│   │       └── reset.scss           # 样式重置
│   ├── components/                  # 通用组件
│   │   ├── common/                  # 基础通用组件
│   │   │   ├── Button.vue
│   │   │   ├── Modal.vue
│   │   │   ├── Loading.vue
│   │   │   └── Toast.vue
│   │   ├── wheel/                   # 转盘相关组件
│   │   │   ├── WheelCanvas.vue      # 转盘画布组件
│   │   │   ├── WheelPointer.vue     # 转盘指针组件
│   │   │   ├── WheelButton.vue      # 转动按钮组件
│   │   │   └── WheelResult.vue      # 结果显示组件
│   │   └── form/                    # 表单相关组件
│   │       ├── FormInput.vue
│   │       ├── FormSelect.vue
│   │       └── FormList.vue
│   ├── views/                       # 页面组件
│   │   ├── Home.vue                 # 首页（转盘页面）
│   │   └── Management.vue           # 管理页面
│   ├── composables/                 # 组合式函数
│   │   ├── useWheel.ts              # 转盘逻辑
│   │   ├── useStorage.ts            # 本地存储
│   │   ├── useAnimation.ts          # 动画控制
│   │   └── useValidation.ts         # 表单验证
│   ├── stores/                      # Pinia 状态管理
│   │   ├── index.ts                 # Store 入口
│   │   ├── wheel.ts                 # 转盘数据状态
│   │   └── app.ts                   # 应用全局状态
│   ├── types/                       # TypeScript 类型定义
│   │   ├── index.ts                 # 类型导出
│   │   ├── wheel.ts                 # 转盘相关类型
│   │   └── storage.ts               # 存储相关类型
│   ├── utils/                       # 工具函数
│   │   ├── index.ts                 # 工具函数导出
│   │   ├── storage.ts               # 存储工具
│   │   ├── wheel.ts                 # 转盘计算工具
│   │   ├── validation.ts            # 验证工具
│   │   └── constants.ts             # 常量定义
│   ├── router/                      # 路由配置
│   │   └── index.ts                 # 路由定义
│   ├── App.vue                      # 根组件
│   └── main.ts                      # 应用入口
├── docs/                            # 文档目录
│   ├── 需求文档.md
│   └── 技术方案.md
├── tests/                           # 测试目录（可选）
│   ├── unit/                        # 单元测试
│   └── e2e/                         # 端到端测试
├── .env                             # 环境变量
├── .env.development                 # 开发环境变量
├── .env.production                  # 生产环境变量
├── .eslintrc.js                     # ESLint 配置
├── .prettierrc                      # Prettier 配置
├── tsconfig.json                    # TypeScript 配置
├── vite.config.ts                   # Vite 配置
├── package.json                     # 项目依赖配置
└── README.md                        # 项目说明文档
```

## 3. 核心模块设计

### 3.1 数据模型设计

#### 3.1.1 转盘套餐数据结构
```typescript
interface WheelSet {
  id: string;                    // 唯一标识
  name: string;                  // 套餐名称
  items: WheelItem[];            // 餐食选项列表
  createdAt: Date;               // 创建时间
  updatedAt: Date;               // 更新时间
}

interface WheelItem {
  id: string;                    // 唯一标识
  name: string;                  // 餐食名称
  color?: string;                // 扇形颜色（可选）
}
```

#### 3.1.2 应用状态结构
```typescript
interface AppState {
  wheelSets: WheelSet[];         // 转盘套餐列表
  currentWheelSetId: string;     // 当前选中的套餐ID
  isSpinning: boolean;           // 转盘是否正在旋转
  lastResult: WheelItem | null;  // 上次转动结果
}
```

### 3.2 组件架构设计

#### 3.2.1 转盘组件 (WheelCanvas.vue)
- **职责**: 渲染转盘视觉效果，处理旋转动画
- **输入**: 转盘数据、旋转角度、动画状态
- **输出**: 旋转完成事件、选中结果

#### 3.2.2 管理组件 (Management.vue)
- **职责**: 套餐管理界面，CRUD 操作
- **子组件**: 套餐列表、编辑表单、预览区域

### 3.3 状态管理设计

#### 3.3.1 Wheel Store (stores/wheel.ts)
- **状态**: 转盘套餐数据、当前选中套餐、旋转状态
- **操作**: 增删改查套餐、切换套餐、更新旋转状态
- **持久化**: 与 localStorage 同步

#### 3.3.2 App Store (stores/app.ts)
- **状态**: 全局加载状态、主题设置、用户偏好
- **操作**: 全局状态管理

## 4. 技术实现方案

### 4.1 转盘渲染方案

#### 4.1.1 Canvas 渲染
- 使用 HTML5 Canvas API 绘制转盘
- 动态计算扇形角度和位置
- 支持自定义颜色和文字

#### 4.1.2 动画实现
- CSS3 Transform + Transition 实现基础旋转
- 使用 RequestAnimationFrame 实现流畅动画
- 缓动函数实现逐渐减速效果

### 4.2 数据存储方案

#### 4.2.1 localStorage 封装
```typescript
class StorageManager {
  private readonly STORAGE_KEY = 'wheel-turntable-data';
  
  save(data: AppState): void;
  load(): AppState | null;
  clear(): void;
}
```

#### 4.2.2 数据同步策略
- 实时同步：每次数据变更立即保存
- 错误处理：存储失败时的降级方案
- 数据迁移：版本升级时的数据兼容性

### 4.3 响应式设计方案

#### 4.3.1 断点设计
- Mobile: < 768px
- Tablet: 768px - 1024px  
- Desktop: > 1024px

#### 4.3.2 适配策略
- 转盘大小自适应屏幕尺寸
- 管理界面在移动端采用堆叠布局
- 触摸设备优化交互体验

## 5. 性能优化方案

### 5.1 构建优化
- **代码分割**: 路由级别的懒加载
- **资源压缩**: Vite 自动压缩 JS/CSS/HTML
- **Tree Shaking**: 移除未使用的代码
- **Bundle 分析**: 使用 rollup-plugin-visualizer

### 5.2 运行时优化
- **虚拟滚动**: 大量数据列表优化（如有需要）
- **防抖节流**: 用户交互事件优化
- **内存管理**: 及时清理事件监听器和定时器
- **缓存策略**: 合理使用浏览器缓存

### 5.3 动画优化
- **GPU 加速**: 使用 transform3d 触发硬件加速
- **帧率控制**: 确保动画 60fps 流畅度
- **减少重排重绘**: 优化 DOM 操作

## 6. 开发规范

### 6.1 代码规范
- **命名规范**: 
  - 组件名：PascalCase
  - 文件名：kebab-case
  - 变量名：camelCase
  - 常量名：UPPER_SNAKE_CASE

- **组件规范**:
  - 使用 Composition API
  - 单文件组件结构：template -> script -> style
  - Props 定义使用 TypeScript 接口

### 6.2 Git 规范
- **分支策略**: GitFlow
- **提交规范**: Conventional Commits
- **代码审查**: 必须经过 Code Review

### 6.3 测试策略
- **单元测试**: 核心业务逻辑和工具函数
- **组件测试**: 关键 UI 组件
- **端到端测试**: 主要用户流程

## 7. 部署方案

### 7.1 构建配置
- **开发环境**: 热重载、Source Map、详细错误信息
- **生产环境**: 代码压缩、资源优化、错误收集

### 7.2 部署策略
- **静态托管**: 支持 GitHub Pages、Netlify、Vercel
- **CDN 加速**: 静态资源 CDN 分发
- **PWA 支持**: 离线缓存和安装提示（可选）

## 8. 风险评估与应对

### 8.1 技术风险
- **浏览器兼容性**: 
  - 风险：老版本浏览器不支持某些特性
  - 应对：Polyfill 和特性检测

- **性能问题**:
  - 风险：动画卡顿、内存泄漏
  - 应对：性能监控和优化

### 8.2 数据风险
- **数据丢失**:
  - 风险：localStorage 被清除
  - 应对：数据导出功能、云端备份（后期）

## 9. 开发计划

### 9.1 开发阶段
1. **第一阶段**: 项目初始化、基础架构搭建
2. **第二阶段**: 转盘核心功能开发
3. **第三阶段**: 管理功能开发
4. **第四阶段**: 样式优化、响应式适配
5. **第五阶段**: 测试、优化、部署

### 9.2 里程碑
- **MVP 版本**: 基础转盘功能
- **完整版本**: 包含所有需求功能
- **优化版本**: 性能和体验优化

## 10. 后续扩展技术预研

### 10.1 功能扩展技术方案
- **图片支持**: 使用 Canvas drawImage API
- **分享功能**: Web Share API 或自定义分享
- **历史记录**: IndexedDB 存储大量数据

### 10.2 技术栈升级
- **移动端**: 考虑使用 Capacitor 打包原生应用
- **云端同步**: 后端 API 设计和实现
- **多语言**: Vue I18n 国际化方案 