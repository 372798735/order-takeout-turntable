<!--management.wxml-->
<view class="container">
  <!-- 套餐管理 -->
  <view class="section">
    <view class="card">
      <view class="card-header">
        <text>转盘套餐管理</text>
        <button class="btn btn-primary btn-sm" bindtap="showAddSetModal">
          + 新建套餐
        </button>
      </view>
      <view class="card-body">
        <view class="set-list" wx:if="{{wheelSets.length > 0}}">
          <view 
            class="set-item {{item.id === currentSetId ? 'active' : ''}}"
            wx:for="{{wheelSets}}"
            wx:key="id"
            bindtap="selectSet"
            data-id="{{item.id}}"
            data-index="{{index}}"
          >
            <view class="set-info">
              <text class="set-name">{{item.name}}</text>
              <text class="set-count">{{item.items.length}} 个选项</text>
            </view>
            <view class="set-actions">
              <button 
                class="btn btn-secondary btn-sm" 
                bindtap="editSet" 
                data-id="{{item.id}}"
                data-index="{{index}}"
                catchtap=""
              >
                编辑
              </button>
              <button 
                class="btn btn-danger btn-sm" 
                bindtap="deleteSet" 
                data-id="{{item.id}}"
                data-index="{{index}}"
                catchtap=""
                wx:if="{{wheelSets.length > 1}}"
              >
                删除
              </button>
            </view>
          </view>
        </view>
        <view class="empty" wx:else>
          <view class="empty-icon">📝</view>
          <view class="empty-text">还没有转盘套餐，点击上方按钮创建一个吧！</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 选项管理 -->
  <view class="section" wx:if="{{currentSet}}">
    <view class="card">
      <view class="card-header">
        <text>{{currentSet.name}} - 选项管理</text>
        <button class="btn btn-primary btn-sm" bindtap="showAddItemModal">
          + 添加选项
        </button>
      </view>
      <view class="card-body">
        <view class="item-list" wx:if="{{currentSet.items.length > 0}}">
          <view 
            class="item-row"
            wx:for="{{currentSet.items}}"
            wx:key="id"
          >
            <view class="item-info">
              <view class="item-color" style="background-color: {{item.color || '#f0f0f0'}}"></view>
              <view class="item-details">
                <text class="item-name">{{item.name}}</text>
                <text class="item-description" wx:if="{{item.description}}">{{item.description}}</text>
              </view>
            </view>
            <view class="item-actions">
              <button 
                class="btn btn-secondary btn-sm" 
                bindtap="editItem" 
                data-id="{{item.id}}"
                data-index="{{index}}"
              >
                编辑
              </button>
              <button 
                class="btn btn-danger btn-sm" 
                bindtap="deleteItem" 
                data-id="{{item.id}}"
                data-index="{{index}}"
              >
                删除
              </button>
            </view>
          </view>
        </view>
        <view class="empty" wx:else>
          <view class="empty-icon">🎯</view>
          <view class="empty-text">这个套餐还没有选项，点击上方按钮添加一些吧！</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 添加/编辑套餐弹窗 -->
  <view class="modal {{showSetModal ? 'show' : ''}}" bindtap="hideSetModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">{{editingSet ? '编辑套餐' : '新建套餐'}}</text>
        <button class="modal-close" bindtap="hideSetModal">×</button>
      </view>
      <view class="modal-body">
        <view class="form-group">
          <text class="form-label">套餐名称</text>
          <input 
            class="input" 
            placeholder="请输入套餐名称" 
            value="{{setForm.name}}"
            bindinput="onSetNameInput"
            maxlength="20"
          />
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideSetModal">取消</button>
        <button class="btn btn-primary" bindtap="saveSet">保存</button>
      </view>
    </view>
  </view>

  <!-- 添加/编辑选项弹窗 -->
  <view class="modal {{showItemModal ? 'show' : ''}}" bindtap="hideItemModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">{{editingItem ? '编辑选项' : '添加选项'}}</text>
        <button class="modal-close" bindtap="hideItemModal">×</button>
      </view>
      <view class="modal-body">
        <view class="form-group">
          <text class="form-label">选项名称</text>
          <input 
            class="input" 
            placeholder="请输入选项名称" 
            value="{{itemForm.name}}"
            bindinput="onItemNameInput"
            maxlength="10"
          />
        </view>
        <view class="form-group">
          <text class="form-label">备注说明</text>
          <textarea 
            class="input textarea" 
            placeholder="请输入备注说明（可选）" 
            value="{{itemForm.description}}"
            bindinput="onItemDescInput"
            maxlength="100"
          ></textarea>
        </view>
        <view class="form-group">
          <text class="form-label">颜色选择</text>
          <view class="color-picker">
            <view 
              class="color-option {{itemForm.color === color ? 'selected' : ''}}"
              wx:for="{{colorOptions}}"
              wx:for-item="color"
              wx:key="*this"
              style="background-color: {{color}}"
              bindtap="selectColor"
              data-color="{{color}}"
            ></view>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideItemModal">取消</button>
        <button class="btn btn-primary" bindtap="saveItem">保存</button>
      </view>
    </view>
  </view>
</view>
