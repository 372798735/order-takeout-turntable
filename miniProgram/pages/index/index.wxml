<!--index.wxml-->
<view class="page">
  <!-- 主内容区域 -->
  <view class="main">
    <!-- 转盘卡片 -->
    <view class="wheel-card card">
      <view class="card-header">
        <view class="set-select-container">
          <view class="set-select">
            <text class="set-label">当前转盘：</text>
            <picker 
              bindchange="onSetChange" 
              value="{{currentSetIndex}}" 
              range="{{wheelSetNames}}"
              class="set-dropdown"
            >
              <view class="picker-display">
                {{currentSetName || '请选择转盘'}}
                <text class="picker-arrow">▼</text>
              </view>
            </picker>
          </view>
        </view>
      </view>

      <view class="card-body">
        <view class="wheel-container fade-up">
          <!-- 实时文案显示 -->
          <view class="realtime-text {{isSpinning ? 'active' : ''}}">
            <text class="text-content">{{realtimeText}}</text>
          </view>
          
          <!-- 当前指向的项目显示 -->
          <!-- <view 
            class="current-item-display {{isSpinning ? 'spinning-mode' : (lastResult ? 'result-mode' : '')}}"
          >
            <text class="current-item-text">{{currentItemText}}</text>
          </view> -->
          
          <!-- 转盘组件 -->
          <wheel-canvas 
            class="wheel"
            items="{{currentItems}}"
            size="{{wheelSize}}"
            bind:item-click="onItemClick"
            bind:hub-click="onSpin"
            bind:end="onSpinEnd"
            bind:current-change="onCurrentChange"
            id="wheelCanvas"
          ></wheel-canvas>
        </view>
      </view>
    </view>

    <!-- 三角形指针（与转盘卡片同级） -->
    <!-- <view class="external-pointer-container" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); margin-top: 50rpx; z-index: 100; width: 580rpx; height: 580rpx; pointer-events: none;">
      <view class="pointer glow {{isSpinning ? 'pointer-active' : ''}}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
        <view class="pointer-triangle" style="position: absolute; top: 50%; left: 50%; width: 0; height: 0; border-left: 24rpx solid transparent; border-right: 24rpx solid transparent; border-bottom: 36rpx solid #6750a4; transform: translate(-50%, -80rpx);"></view>
      </view>
    </view> -->
    
    <!-- 中心GO按钮（与转盘卡片同级） -->
    <!-- <view class="external-hub-container" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); margin-top: 50rpx; z-index: 999; width: 80rpx; height: 80rpx; pointer-events: none;">
      <view class="hub {{isSpinning ? 'breathing' : ''}}" bindtap="onSpin" catchtap="onSpin" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: auto;">
        <view class="hub-button" style="position: absolute; top: 0; left: 0; width: 80rpx; height: 80rpx; border-radius: 40rpx; background-color: transparent; z-index: 1000;">
          <image class="center-image" src="/images/center.png" mode="aspectFit" lazy-load="{{false}}" show-menu-by-longpress="{{false}}" binderror="onImageError" style="width: 80rpx; height: 80rpx; border-radius: 40rpx; display: block; z-index: 1001;"></image>
          <view class="center-fallback" wx:if="{{showFallback}}" style="position: absolute; top: 0; left: 0; width: 80rpx; height: 80rpx; border-radius: 40rpx; background: linear-gradient(135deg, #6750a4, #7c5ce8); color: white; font-size: 24rpx; font-weight: bold; display: flex; align-items: center; justify-content: center; z-index: 1002;">GO</view>
        </view>
      </view>
    </view> -->

    <!-- 状态信息卡片 -->
    <view class="status-card card">
      <view class="card-header">
        <text>提示与状态</text>
      </view>
      <view class="card-body">
        <view class="status-list">
          <view class="status-item">
            <text class="status-label">选项数量</text>
            <text class="status-value">{{currentItems.length}}</text>
          </view>
          <view class="status-item">
            <text class="status-label">是否旋转中</text>
            <text class="status-value">{{isSpinning ? '是' : '否'}}</text>
          </view>
          <view class="status-item">
            <text class="status-label">上次结果</text>
            <text class="status-value">{{lastResult ? lastResult.name : '—'}}</text>
          </view>
        </view>
        
        <view class="divider"></view>
        
        <view class="tips">
          <view class="tip-title">💡 小提示</view>
          <view class="tip-content">
            <text>使用管理页可添加/排序选项，建议保持 6~12 个扇区获得更佳视觉与节奏。</text>
            <text>💡 点击转盘上的任意选项可查看详情信息！</text>
            <text>🎯 点击中心的GO按钮开始转盘抽取！</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
